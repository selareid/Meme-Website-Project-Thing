<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="shortcut icon" href="favicon.ico">
        <link rel="icon" href="favicon.ico">
        <meta charset="utf-8">
        <title>Daniel Reid - QA</title>
        <link rel="stylesheet" href="style.css" media="screen, projection">
        <link rel="stylesheet" href="style-index.css" media="screen, projection">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <style>
            #QAInput {
                width: 500px;
                height: 500px;
            }
            #Content {
                margin-left: 46px;
            }
            #QADesc {
                margin-left: 46px;
            }
        </style>
        <link rel="stylesheet" href="style.css">
        <script src="jQuery.js"></script>
        <script src="analytics.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.6.7/firebase.js"></script>
    </head>
    <body>

        <div class="side-strip"></div>
        <div class="background"></div>

        <div class="header"></div>
        <div id="navigation-bar-filler"></div>

        <p id="QADesc">
            Put Questions & Answers in the large text field below
            <br>
            Use : to separate Questions & Answers
            <br>
            and a , to separate Question/Answer combinations
            <br>
            Once ready press Start.
            <br>
        </p>

        <div id="Content">
            <div id="thingsToHide">
            <p id="save"></p>

            <textarea id="QAInput">
Question1:Answer1,Question2:Answer2</textarea>
                <br>
                <button id="submitButton" type="button">Start</button>
            </div>

            <p id="Question"></p>
            <br>

            <input id="answerInput" type="text">
            <button id="answerButton" type="button">Answer</button>
            <br>

            <p id="feedback" style="display: none">FeedBack!</p>
        </div>

    </body>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyBvUv9LodKvAEQRaP8y2_JT0bpRxTtS8-8",
            authDomain: "my-awesome-project-6c0b4.firebaseapp.com",
            databaseURL: "https://my-awesome-project-6c0b4.firebaseio.com",
            storageBucket: "my-awesome-project-6c0b4.appspot.com",
            messagingSenderId: "453232744906"
        };
        firebase.initializeApp(config);
        var database = firebase.database();

        firebase.auth().signInAnonymously().catch(function(error) {
            // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;
            if (errorCode) console.log(errorCode);
            if (errorMessage) console.log(errorMessage);
            // ...
        });

        function saveQAsToDatabase(QAs, userInfo, dateInfo = new Date()) {
            var user = firebase.auth().currentUser;
            console.log(user);
            if (user) {
                firebase.database().ref('QAThing/' + 'users/' + user.uid).set({
                    QAs: QAs,
                    userDate: dateInfo.toLocaleString(),
                    userTimeOffUTC: dateInfo.getTimezoneOffset()/60,
                    userInfo: userInfo
                });
                console.log('wrote');
            }
        }


        runAnalytics();
        $(function() {
            $('#navigation-bar-filler').load('navigation-bar.html');
            $('.header').load('header.html');
        });


        var save = document.getElementById("save");
        var QAInput = document.getElementById("QAInput");
        var submitButton = document.getElementById("submitButton");
        var answerInput = document.getElementById("answerInput");
        var answerButton = document.getElementById("answerButton");
        var feedback = document.getElementById("feedback");

        submitButton.onclick = function () {
            document.getElementById('thingsToHide').style.display = 'none';
            setQA();
            document.getElementById("Question").innerHTML = 'Question:  ' + save.innerHTML.split(':')[0];


            $.getJSON('https://ipinfo.io', function(data){
                saveQAsToDatabase(QAInput.value.split(','), data);
            });
        };

        answerButton.onclick = function () {
            feedback.style.display = 'block';
            if (answerInput.value.toLowerCase() === save.innerHTML.split(':')[1].toLowerCase()) {
                feedback.innerHTML = 'Correct Answer!';
                setTimeout(function(){submitButton.onclick();}, 1000);
            }
            else {
                feedback.innerHTML = 'Incorrect Answer' + '<br>' + ' The correct answer is: ' + save.innerHTML.split(':')[1] + '<br>' + 'Input the correct answer to continue...';
            }
        };

        function setQA() {
            feedback.style.display = 'none';
            var QA = QAInput.value.split(',')[Math.floor(Math.random()*QAInput.value.split(',').length)];
            console.log(QA);
            save.innerHTML = QA;
            answerInput.value = '';
        }


    </script>
</html>